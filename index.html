<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Question Asking</title>
  <style>
    :root{
      --accent:#0078d4; --accent-dark:#005a9e; --panel:#fafafa; --border:#e6e6e6;
      --correct:#198754; --wrong:#d9534f; --note:#fd7e14;
    }
    body{
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin:20px; color:#222; line-height:1.45;
    }
    h1{ margin:0 0 10px 0; font-size:1.3rem; }
    main{ max-width:900px; }
    .question{
      border:1px solid var(--border);
      background:var(--panel);
      padding:12px; margin:12px 0; border-radius:8px;
    }
    .question h4{ margin:0 0 8px 0; font-size:1rem; }
    .answer-sentence{ margin:6px 0 10px 0; }
    .choices label{ display:block; margin:6px 0; cursor:pointer; }
    .controls-row{ display:flex; gap:8px; align-items:center; margin-top:10px; flex-wrap:wrap; }
    button.submit-q{
      background:var(--accent); color:#fff; border:none; padding:8px 12px; border-radius:6px; cursor:pointer;
    }
    button.submit-q[disabled]{ opacity:.6; cursor:not-allowed; }
    .feedback{ margin-top:10px; min-height:2.2em; }
    .badge{
      display:inline-block; padding:6px 10px; border-radius:16px; color:#fff; font-weight:700;
      font-size:.9rem; margin-right:8px;
    }
    .badge.correct{ background:var(--correct); }
    .badge.wrong{ background:var(--wrong); }
    .badge.unanswered{ background:var(--note); }
    .explain{ margin-top:6px; color:#333; }
    #score{ margin-top:16px; font-weight:700; }
    @media (max-width:520px){ body{ margin:12px } }
  </style>
</head>
<body>
  <main>
    <h1>Question Asking</h1>

    <div id="quiz" aria-live="polite"></div>

    <div id="score" aria-atomic="true"></div>
  </main>

  <script>
    // Adjusted quiz data:
    // - Question 3 corrected so the answer does not start with "No" when the correct question is "Why...?"
    // - Question 4 made unambiguous (duration only) so only "How long..." is correct
    const quizData = [
      {
        answer: "I'm going to London next week.",
        correct: "When are you going to London?",
        distractors: [
          "Why are you going to London?",
          "Where are you going next week?",
          "How are you going to London?"
        ],
        explanation: "The sentence gives a time, so the question must ask 'When...?' about the date/time."
      },
      {
        answer: "Yes, I've already finished the report.",
        correct: "Have you finished the report?",
        distractors: [
          "Did you finish the report yesterday?",
          "Who finished the report?",
          "Why have you finished the report?"
        ],
        explanation: "Present perfect ('I've already finished') matches the question 'Have you...?'"
      },
      {
        // REVISED: the answer no longer begins with 'No' so it can be a natural response to a 'Why...' question
        answer: "I didn't go because I was ill.",
        correct: "Why didn't you go?",
        distractors: [
          "Did you go?",
          "When were you ill?",
          "Who was ill?"
        ],
        explanation: "The reply explains the reason for not going, so it naturally answers 'Why didn't you go?'."
      },
      {
        // REVISED: remove place reference so only duration is present
        answer: "I studied French for five years.",
        correct: "How long did you study French?",
        distractors: [
          "Where did you study French?",
          "Did you study French at school?",
          "Why did you study French?"
        ],
        explanation: "The answer gives a duration, so 'How long...?' is the appropriate question."
      },
      {
        answer: "She moved here in 2010.",
        correct: "When did she move here?",
        distractors: [
          "Why did she move here?",
          "Who moved here in 2010?",
          "Has she moved here?"
        ],
        explanation: "The sentence supplies a year, therefore the relevant question is 'When...?'"
      },
      {
        answer: "Because the weather was terrible.",
        correct: "Why did you cancel the picnic?",
        distractors: [
          "When did you cancel the picnic?",
          "Did you enjoy the picnic?",
          "Where was the picnic?"
        ],
        explanation: "The reply provides a reason for cancelling, so it answers 'Why...?'"
      },
      {
        answer: "No, she hasn't seen the film yet.",
        correct: "Has she seen the film yet?",
        distractors: [
          "Did she see the film?",
          "When will she see the film?",
          "Who saw the film?"
        ],
        explanation: "The present perfect negative 'hasn't seen' pairs with 'Has she... yet?'"
      },
      {
        answer: "About Â£40.",
        correct: "How much did it cost?",
        distractors: [
          "How long did it take?",
          "Where did you buy it?",
          "Who bought it?"
        ],
        explanation: "A monetary amount answers 'How much...?'"
      },
      {
        answer: "I prefer tea to coffee.",
        correct: "Do you prefer tea or coffee?",
        distractors: [
          "Would you like some tea?",
          "How do you take your tea?",
          "Which is cheaper, tea or coffee?"
        ],
        explanation: "The sentence expresses a preference between two options, so 'Do you prefer...?'"
      },
      {
        answer: "Yes, I can speak a little Spanish.",
        correct: "Can you speak Spanish?",
        distractors: [
          "How well do you speak Spanish?",
          "Where did you learn Spanish?",
          "Will you speak Spanish?"
        ],
        explanation: "This answers ability; 'Can you...?' asks about ability."
      },
      {
        answer: "I bought it last Friday.",
        correct: "When did you buy it?",
        distractors: [
          "Why did you buy it?",
          "How much did it cost?",
          "Where did you buy it?"
        ],
        explanation: "The reply indicates a time ('last Friday') so ask 'When...?'"
      },
      {
        answer: "At the station, just outside platform 3.",
        correct: "Where should I meet you?",
        distractors: [
          "What time should I meet you?",
          "Who will be at platform 3?",
          "Why are you at the station?"
        ],
        explanation: "The reply gives a place, so the question should be 'Where...?'"
      },
      {
        answer: "No, thank you. I'm full.",
        correct: "Would you like more cake?",
        distractors: [
          "Are you full of cake?",
          "Why are you full?",
          "Do you like cake?"
        ],
        explanation: "A polite refusal to more food answers the offer 'Would you like...?'"
      },
      {
        answer: "You need to take the second turning on the left.",
        correct: "How do I get to the post office?",
        distractors: [
          "When does the post office open?",
          "Is the post office open on Sunday?",
          "Where is the second turning?"
        ],
        explanation: "Directions respond to 'How do I get to...?'"
      },
      {
        answer: "Because I forgot my keys.",
        correct: "Why couldn't you get into the house?",
        distractors: [
          "When did you forget your keys?",
          "Where are your keys?",
          "Who had your keys?"
        ],
        explanation: "This gives the reason for not getting in, so 'Why couldn't you...?'"
      },
      {
        answer: "By train; it was much faster than driving.",
        correct: "How did you travel to Manchester?",
        distractors: [
          "When did you travel to Manchester?",
          "Did you like Manchester?",
          "Why did you choose Manchester?"
        ],
        explanation: "Mode of transport answers 'How did you travel...?'"
      },
      {
        answer: "I've lived here since 2018.",
        correct: "How long have you lived here?",
        distractors: [
          "When did you move here?",
          "Did you live here before 2018?",
          "Why did you move here in 2018?"
        ],
        explanation: "A period from 2018 to now requires 'How long have you...?'"
      },
      {
        answer: "No, it's not my responsibility.",
        correct: "Is that your responsibility?",
        distractors: [
          "Whose responsibility is it?",
          "Why isn't it your responsibility?",
          "When is it your responsibility?"
        ],
        explanation: "A direct yes/no response matches 'Is that your responsibility?'"
      },
      {
        answer: "She'll arrive at about half past three.",
        correct: "When will she arrive?",
        distractors: [
          "Why will she arrive?",
          "Who will arrive at half past three?",
          "Where will she arrive?"
        ],
        explanation: "A future time answer corresponds to 'When will...?'"
      },
      {
        answer: "No, I haven't met him before.",
        correct: "Have you met him before?",
        distractors: [
          "When did you meet him?",
          "Who hasn't met him?",
          "Why haven't you met him?"
        ],
        explanation: "Present perfect negative indicates 'Have you... before?'"
      }
    ];

    function shuffle(arr){
      for(let i=arr.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]]=[arr[j],arr[i]];
      }
      return arr;
    }

    const quizDiv = document.getElementById('quiz');

    function buildQuestion(index, item){
      const section = document.createElement('section');
      section.className = 'question';
      section.dataset.index = index;

      const h = document.createElement('h4');
      h.textContent = `Question ${index + 1}`;
      section.appendChild(h);

      const ans = document.createElement('div');
      ans.className = 'answer-sentence';
      ans.innerHTML = `<strong>Given answer:</strong> ${item.answer}`;
      section.appendChild(ans);

      // choices
      const choicesDiv = document.createElement('div');
      choicesDiv.className = 'choices';
      const choices = [ {text:item.correct, correct:true} ].concat(
        item.distractors.map(d => ({text:d, correct:false}))
      );
      shuffle(choices);

      choices.forEach((c, i)=>{
        const id = `q${index}_c${i}`;
        const label = document.createElement('label');
        label.htmlFor = id;

        const input = document.createElement('input');
        input.type = 'radio';
        input.name = `q${index}`;
        input.id = id;
        input.value = c.text;
        input.dataset.correct = c.correct ? '1' : '0';
        input.style.marginRight = '8px';

        const span = document.createElement('span');
        span.textContent = c.text;

        label.appendChild(input);
        label.appendChild(span);
        choicesDiv.appendChild(label);
      });

      section.appendChild(choicesDiv);

      // controls: per-question submit
      const controls = document.createElement('div');
      controls.className = 'controls-row';

      const submitBtn = document.createElement('button');
      submitBtn.type = 'button';
      submitBtn.className = 'submit-q';
      submitBtn.textContent = 'Submit this answer';
      submitBtn.dataset.qindex = index;

      controls.appendChild(submitBtn);
      section.appendChild(controls);

      const feedback = document.createElement('div');
      feedback.className = 'feedback';
      feedback.setAttribute('aria-live','polite');
      section.appendChild(feedback);

      // event: per-question submit
      submitBtn.addEventListener('click', () => {
        handleSubmitForQuestion(index, item, section);
      });

      return section;
    }

    function lockQuestion(index){
      const inputs = document.querySelectorAll(`input[name="q${index}"]`);
      inputs.forEach(inp => {
        inp.disabled = true;
      });
      const btn = document.querySelector(`button.submit-q[data-qindex="${index}"]`);
      if(btn) btn.disabled = true;
    }

    function handleSubmitForQuestion(index, item, section){
      const selected = section.querySelector(`input[name="q${index}"]:checked`);
      const feedback = section.querySelector('.feedback');
      feedback.innerHTML = '';

      if(!selected){
        const badge = document.createElement('span');
        badge.className = 'badge unanswered';
        badge.textContent = 'No answer selected';
        feedback.appendChild(badge);

        const note = document.createElement('div');
        note.className = 'explain';
        note.innerHTML = `<strong>Correct question:</strong> ${item.correct}<br><strong>Explanation:</strong> ${item.explanation}`;
        feedback.appendChild(note);
        lockQuestion(index);
        updateScoreDisplay();
        return;
      }

      const isCorrect = selected.dataset.correct === '1';
      if(isCorrect){
        const badge = document.createElement('span');
        badge.className = 'badge correct';
        badge.textContent = 'Correct';
        feedback.appendChild(badge);

        const text = document.createElement('div');
        text.className = 'explain';
        text.textContent = 'That question naturally elicits the given answer.';
        feedback.appendChild(text);
      } else {
        const badge = document.createElement('span');
        badge.className = 'badge wrong';
        badge.textContent = 'Incorrect';
        feedback.appendChild(badge);

        const corr = document.createElement('div');
        corr.className = 'explain';
        corr.innerHTML = `<strong>Correct question:</strong> ${item.correct}<br><strong>Explanation:</strong> ${item.explanation}`;
        feedback.appendChild(corr);
      }

      lockQuestion(index);
      updateScoreDisplay();
    }

    function updateScoreDisplay(){
      // compute how many submitted and how many correct among submitted
      const total = quizData.length;
      let submitted = 0, correct = 0;
      for(let i=0;i<total;i++){
        const inputs = document.querySelectorAll(`input[name="q${i}"]`);
        const anyDisabled = Array.from(inputs).some(inp => inp.disabled);
        if(anyDisabled){
          submitted++;
          const selected = document.querySelector(`input[name="q${i}"]:checked`);
          if(selected && selected.dataset.correct === '1') correct++;
        }
      }
      const scoreDiv = document.getElementById('score');
      scoreDiv.textContent = `Progress: ${submitted}/${total} answered. Current correct: ${correct}/${total}.`;
    }

    // render all questions
    quizData.forEach((item, idx)=>{
      quizDiv.appendChild(buildQuestion(idx, item));
    });

    // initial score display
    updateScoreDisplay();
  </script>
</body>
</html>
